version: "3"
services:
  cell-sim7600g-h:
    image: iqtlabs/pibackbone-cell-sim7600g-h:stable
    restart: always
    network_mode: host
    privileged: true
    environment:
      - "HOSTNAME=${HOSTNAME}"
    volumes:
      - "/flash/telemetry/gps:/flash/telemetry/gps"
      - "/sys:/sys"
    command:
      - fast.t-mobile.net
      - 300
  environment-sensor:
    image: iqtlabs/pibackbone-environment-sensor:stable
    restart: always
    environment:
      - "HOSTNAME=${HOSTNAME}"
    volumes:
      - "/flash/telemetry/sensors:/flash/telemetry/sensors"
    devices:
      - "/dev/i2c-1:/dev/i2c-1"
  pijuice:
    image: iqtlabs/pibackbone-pijuice:stable
    restart: always
    network_mode: "none"
    environment:
      - "HOSTNAME=${HOSTNAME}"
    volumes:
      - "/flash/telemetry/power:/flash/telemetry/power"
      - "/var/lib/pijuice:/var/lib/pijuice"
      - "/var/run:/var/run"
      - "/home/pi:/home/pi"
    devices:
      - "/dev/i2c-1:/dev/i2c-1"
  s3-upload:
    image: iqtlabs/pibackbone-s3-upload:stable
    restart: always
    environment:
      - "HOSTNAME=${HOSTNAME}"
      - "S3_BUCKET=${S3_BUCKET}"
    volumes:
      - "/flash/telemetry:/flash/telemetry"
      - "/flash/s3:/flash/s3"
      - $HOME/.aws:/root/.aws:ro
  watchtower:
    image: containrrr/watchtower:armhf-latest
    restart: always
    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock"
    environment:
      - "WATCHTOWER_POLL_INTERVAL=3600"
      - "WATCHTOWER_CLEANUP=true"
      - "WATCHTOWER_INCLUDE_RESTARTING=true"
      - "WATCHTOWER_INCLUDE_STOPPED=true"
      - "WATCHTOWER_REVIVE_STOPPED=true"
